<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="description" content="我的網路使用報告-最終資料確認">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Ting-Rui Chen">
    <title>我的網路使用報告-最終資料確認 by Data Analytics Research Team</title>
    <link rel="icon" href="https://github.com/ncu-dart/MySafariReport/blob/master/icon/icon48.png?raw=true">

    <!-- Materialize-->
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Materialize-->
    <link href="https://cdn.shopify.com/s/files/1/1775/8583/t/1/assets/admin-materialize.min.css?0" rel="stylesheet">

    <!-- Material Icons-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
    <main>
        <div class="container">
            <div class="row">
                <div class="col s12 m12 l12 xl12">
                    <div class="card">
                        <div class="card-content">
                            <h4><img src="https://github.com/ncu-dart/MySafariReport/blob/master/icon/icon48.png?raw=true" alt="icon"><span>「我的網路使用報告」最終資料確認</span></h4>
                            <p>恭喜您於 {dt}兌換的「{item}」通過 資料審核</p>
                            <p>目前需要您做 <span class="yellow">最後的資料確認</span>，以確保您可以收到禮券。</p>
                            <p>請檢查以下資訊是否正確，並完成空欄填寫：</p>
                            <div class="row center">
                                <div class="input-field col s6">
                                    <input id="email" type="email" class="validate">
                                    <label for="email">Email</label>
                                </div>
                                <div class="input-field col s6">
                                    <input id="phone" type="text" class="validate">
                                    <label for="phone">手機號碼(09XXXXXXXX)</label>
                                </div>
                                <div class="input-field col s6">
                                    <input id="birthday" type="text" class="datepicker">
                                    <label for="birthday">生日</label>
                                </div>
                                <div class="col s6 ">
                                    <form action="#">
                                        <p>
                                            <label>
                                                <input name="group1" value="1" type="radio" />
                                                <span>男性</span>
                                            </label>
                                            <label>
                                                <input name="group1" value="0" type="radio" />
                                                <span>女性</span>
                                            </label>
                                        </p>
                                    </form>
                                </div>



                            </div>

                            <div class="center">
                                <div id="done" class="btn btn-large pulse disabled">確認資料無誤</div>
                            </div>
                            <p><br></p>
                            <p>完成資料確認後，請您耐心等候，禮券發送工作時間於<span class="light-green accent-2">每日11:00a.m. ~ 23:00p.m.</span>，若不在此時段完成，則需等候次日發送。</p>
                            <p><br></p>
                            <p>若您有任何問題，可直接聯絡開發人員</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="page-footer">
        <div class="container">
            <div class="row">
                <div class="col s12 m6">
                    <img class="materialize-logo" src="https://github.com/ncu-dart/MySafariReport/blob/master/icon/icon128.png?raw=true" alt="Materialize">
                    <p>Copyright © 2019 <br> <a target="_blank" href="https://ncu-dart.github.io/">Data Analytics Research Team(DART)</a>, <br> <a target="_blank" href="https://www.csie.ncu.edu.tw/">Department of Computer Science & Information
                            Engineering(CSIE)</a>, <br> <a target="_blank" href="https://www.ncu.edu.tw/">National Central University(NCU)</a> <br> All rights reserved. </p>
                </div>
                <div class="col s12 m3">
                    <h5>關於</h5>
                    <ul>
                        <li><a target="_blank" href="https://chrome.google.com/webstore/detail/anepijmkiffdjchfonbcnngnkogjllhg/">Chrome 擴充功能商店</a></li>
                    </ul>
                </div>
                <div class="col s12 m3">
                    <h5>聯絡我們</h5>
                    <ul>
                        <li><a href="mailto:ray941216@g.ncu.edu.tw">Email</a></li>
                        <li><a target="_blank" href="https://github.com/ncu-dart/MySafariReport/blob/master/README.md">Github</a></li>
                    </ul>
                </div>
            </div>

        </div>
    </footer>


</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!-- Compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script type="text/javascript">
    $('.datepicker').datepicker({init});

    $("#email").val("{email}")
    $("#email").data('last', "{email}")
    $("#email").on('blur', function() {{
        val = $("#email").val()
        if (!$("#email").hasClass("invalid") && val.length > 0 && val != $("#email").data('last')) {{

            $.ajax({{
                'type': "POST",
                'url': "https://ncu-dart-chrome-ext-cache-beta.herokuapp.com/profile/EMAIL",
                'dataType': 'json',
                'crossDomain': true,
                'contentType': "application/json",
                'data': JSON.stringify({{
                    'uuid': '{uuid}',
                    'new': val
                }}),
                'success': function(xhr) {{
                    console.log(xhr);
                    console.log('done');
                }},
                'error': function(xhr) {{
                    console.log(xhr);
                }},
            }});


            $("#email").data('last', val)
        }} else {{
            if ($("#email").data("last") !== undefined) {{
                $("#email").val($("#email").data("last"))
            }} else {{
                $("#email").val("")
            }}
        }}
        M.updateTextFields();
    }});

    $("#phone").val("{phone}")
    $("#phone").data('last', '{phone}')
    $("#phone").on('blur', function() {{
        val = $("#phone").val()
        var re = new RegExp(/^09\d{{8}}$/);
        if (re.test(val) && $("#phone").data("last") != val) {{

            $.ajax({{
                'type': "POST",
                'url': "https://ncu-dart-chrome-ext-cache-beta.herokuapp.com/profile/PHONE",
                'dataType': 'json',
                'crossDomain': true,
                'contentType': "application/json",
                'data': JSON.stringify({{
                    'uuid': '{uuid}',
                    'new': val
                }}),
                'success': function(xhr) {{
                    console.log(xhr);
                    console.log('done');
                }},
                'error': function(xhr) {{
                    console.log(xhr);
                }},

            }})

            $("#phone").data('last', val)
        }} else {{
            if ($("#phone").data("last") !== undefined) {{
                $("#phone").val($("#phone").data("last"))
            }} else {{
                $("#phone").val("")
            }}
        }}
        M.updateTextFields();
    }});

    var submit = function() {{
        flag = 0
        var done_ = function (){{
            ++flag
            if (flag == 4) {{
                $.ajax({{
                    'type': "POST",
                    'url': "https://ncu-dart-chrome-ext-cache-beta.herokuapp.com/last_stage_done",
                    'dataType': 'json',
                    'crossDomain': true,
                    'contentType': "application/json",
                    'data': JSON.stringify({{
                        'uuid': '{uuid}',
                        'item': '{item}',
                        'dtstamp': '{dtstamp}'
                    }}),
                    'success': function(xhr) {{
                        console.log(xhr);
                        console.log('done');
                        alert("完成！感謝您的協助，頁面即將關閉！")
                        window.close();
                    }},
                    'error': function(xhr) {{
                        console.log(xhr);
                        alert("出錯了！請聯絡開發人員！")
                        location.reload()
                    }},

                }})


            }}
        }}
        val = $("#email").val()
        if (!$("#email").hasClass("invalid") && val.length > 0 && val != $("#email").data('last')) {{
            $.ajax({{
                'type': "POST",
                'url': "https://ncu-dart-chrome-ext-cache-beta.herokuapp.com/profile/EMAIL",
                'dataType': 'json',
                'crossDomain': true,
                'contentType': "application/json",
                'data': JSON.stringify({{
                    'uuid': '{uuid}',
                    'new': val
                }}),
                'success': function(xhr) {{
                    console.log(xhr);
                    done_()
                    console.log('done');
                }},
                'error': function(xhr) {{
                    console.log(xhr);
                }},
            }});
        }}
        else {{
            done_()
        }}

        val = $("#phone").val()
        var re = new RegExp({reg});
        if (re.test(val) && $("#phone").data("last") != val) {{
            $.ajax({{
                'type': "POST",
                'url': "https://ncu-dart-chrome-ext-cache-beta.herokuapp.com/profile/PHONE",
                'dataType': 'json',
                'crossDomain': true,
                'contentType': "application/json",
                'data': JSON.stringify({{
                    'uuid': '{uuid}',
                    'new': val
                }}),
                'success': function(xhr) {{
                    console.log(xhr);
                    done_()
                    console.log('done');
                }},
                'error': function(xhr) {{
                    console.log(xhr);
                }},

            }})
        }}
        else {{
            done_()
        }}

        val = $("#birthday").val()
        $.ajax({{
            'type': "POST",
            'url': "https://ncu-dart-chrome-ext-cache-beta.herokuapp.com/profile/BIRTH",
            'dataType': 'json',
            'crossDomain': true,
            'contentType': "application/json",
            'data': JSON.stringify({{
                'uuid': '{uuid}',
                'new': val
            }}),
            'success': function(xhr) {{
                console.log(xhr);
                console.log('done');
                done_()

            }},
            'error': function(xhr) {{
                console.log(xhr);
            }},

        }})
        val = $("form :checked").val()
        $.ajax({{
            'type': "POST",
            'url': "https://ncu-dart-chrome-ext-cache-beta.herokuapp.com/profile/GENDER",
            'dataType': 'json',
            'crossDomain': true,
            'contentType': "application/json",
            'data': JSON.stringify({{
                'uuid': '{uuid}',
                'new': val
            }}),
            'success': function(xhr) {{
                console.log(xhr);
                done_()
                console.log('done');
            }},
            'error': function(xhr) {{
                console.log(xhr);
            }},

        }})


    }}

    $("#done").on('click', function() {{
        if (confirm("確定資料都正確了？")) {{
            submit()
        }}

    }})
    $("#done").on('tap', function() {{
        if (confirm("確定資料都正確了？")) {{
            submit()
        }}
    }})

    $('form').on("change", function() {{
        if ($("#birthday").val() !== "") {{
            $("#done").removeClass("disabled")
        }}
    }})

    $("#birthday").on("change", function() {{
        if ($("form :checked").val() !== undefined) {{
            $("#done").removeClass("disabled")
        }}
    }})

</script>

</html>
